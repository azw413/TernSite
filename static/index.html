<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TernReader Tools</title>
  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="icon" type="image/png" href="/favicon.png">
  <link rel="stylesheet" href="/style.css" />
</head>
<body>
  <header class="hero">
    <img src="/ternreader_logo_4color.svg" alt="TernReader logo" class="logo" />
    <div>
      <h1>TernReader Web Tools</h1>
      <p>Drag and drop EPUB or images for conversion, then flash the latest app firmware.</p>
    </div>
  </header>

  <main class="grid">
    <section class="card wide file-manager">
      <div class="file-manager-header">
        <div>
          <h2>Device Files</h2>
          <p class="muted">Browse, delete, and add converted files directly on your TernReader.</p>
        </div>
        <div class="file-manager-actions">
          <button id="fm-connect-btn" type="button">Connect USB</button>
          <button id="fm-refresh-btn" type="button" disabled>Refresh</button>
          <button id="fm-new-btn" type="button" disabled>New Folder</button>
          <button id="fm-add-btn" class="icon-btn" type="button" disabled>+</button>
        </div>
      </div>
      <div id="fm-status" class="muted">Not connected.</div>
      <div id="fm-breadcrumbs" class="breadcrumbs"></div>
      <div class="file-table">
        <div class="file-row file-header">
          <div>Name</div>
          <div>Size</div>
          <div>Actions</div>
        </div>
        <div id="fm-list"></div>
      </div>
      <div id="fm-empty" class="muted empty-state">No files here yet.</div>
      <details class="usb-log-wrap">
        <summary>USB log</summary>
        <pre id="usb-log" class="log"></pre>
      </details>
    </section>

    <section class="card wide">
      <h2>Flash Latest App Firmware</h2>
      <p>Uses WebSerial. Supported in Chrome and Edge.</p>
      <div class="flash-info">
        <div>
          <div class="label">Latest asset</div>
          <div id="fw-name">Loading…</div>
        </div>
        <div>
          <div class="label">Version</div>
          <div id="fw-tag">—</div>
        </div>
        <div>
          <div class="label">Size</div>
          <div id="fw-size">—</div>
        </div>
      </div>
      <div class="actions">
        <button id="connect-btn" type="button">Connect Device</button>
        <button id="flash-btn" type="button" disabled>Flash App Image</button>
        <button id="download-btn" type="button">Download App Image</button>
      </div>
      <div class="progress-wrap">
        <div class="progress-track">
          <div id="flash-progress" class="progress-bar" style="width: 0%"></div>
        </div>
        <div id="flash-percent" class="muted">0%</div>
      </div>
      <pre id="flash-log" class="log"></pre>
    </section>

  </main>

  <footer>
    <p>API: <code>/api/convert/image</code>, <code>/api/convert/book</code>, <code>/api/firmware/latest</code></p>
    <p>GitHub: <a href="https://github.com/azw413/TernReader" target="_blank" rel="noreferrer">https://github.com/azw413/TernReader</a></p>
  </footer>

  <div id="convert-modal" class="modal">
    <div class="modal-card">
      <div class="modal-header">
        <h2>Convert & Upload</h2>
        <button id="convert-close" class="icon-btn" type="button">X</button>
      </div>
      <p class="muted">Drop a file to convert. It will upload into the current directory.</p>
      <div id="convert-target" class="muted upload-target"></div>

      <div id="drop-zone" class="drop-zone">
        <input id="file-input" type="file" accept=".epub,image/png,image/jpeg" />
        <div>
          <strong>Drop file here</strong>
          <div class="muted">or click to choose</div>
          <div id="file-name" class="file-name">No file selected</div>
        </div>
      </div>

      <div class="options">
        <div class="option-card" id="image-options">
          <h3>Image Options</h3>
          <label>
            Output filename
            <input id="image-output" type="text" value="converted.tri" />
          </label>
          <label>
            Region mode
            <select id="image-region">
              <option value="auto" selected>Auto</option>
              <option value="barcode">Barcode</option>
              <option value="crisp">Crisp</option>
              <option value="none">None</option>
            </select>
          </label>
          <label>
            Fit mode
            <select id="image-fit">
              <option value="width" selected>Width</option>
              <option value="contain">Contain</option>
              <option value="cover">Cover</option>
              <option value="stretch">Stretch</option>
              <option value="integer">Integer</option>
            </select>
          </label>
          <label>
            Dither
            <select id="image-dither">
              <option value="bayer" selected>Bayer</option>
              <option value="none">None</option>
            </select>
          </label>
          <label class="inline">
            <input type="checkbox" id="image-invert" />
            Invert
          </label>
          <label>
            TRIM version
            <select id="image-trim">
              <option value="1">v1 (mono1)</option>
              <option value="2" selected>v2 (gray2)</option>
            </select>
          </label>
        </div>

        <div class="option-card" id="book-options">
          <h3>Book Options</h3>
          <label>
            Output filename
            <input id="book-output" type="text" value="converted.trbk" />
          </label>
          <label>
            Font
            <select id="book-font">
              <option value="bookerly" selected>Bookerly</option>
            </select>
          </label>
          <label>
            Sizes (comma-separated)
            <input id="book-sizes" type="text" value="24" />
          </label>
          <p class="hint">Currently only Bookerly is available.</p>
        </div>
      </div>

      <div class="actions">
        <button id="convert-btn" type="button">Convert</button>
        <span id="convert-status" class="muted"></span>
      </div>
      <div class="progress-wrap upload-progress">
        <div class="progress-track">
          <div id="upload-progress" class="progress-bar" style="width: 0%"></div>
        </div>
        <div id="upload-percent" class="muted">0%</div>
      </div>
    </div>
  </div>

  <script type="module" src="/app.js"></script>
</body>
</html>
